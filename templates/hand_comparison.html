{% extends "base_cassette.html" %}

{% block title %}FlowState - Hand Comparison{% endblock %}

{% block vertical_text %}HANDS{% endblock %}
{% block right_vertical_text %}COMPARISON{% endblock %}
{% block red_panel %}{% endblock %}

{% block back_button %}
<button onclick="window.location.href='/'"
    class="absolute top-[100px] left-4 md:left-8 z-10 bg-secondary border-4 border-foreground px-4 py-2 font-display text-lg tracking-widest text-secondary-foreground cursor-pointer btn-3d">
    ‚óÄ BACK
</button>
{% endblock %}

{% block content_margin %}{% endblock %}

{% block cassette_content %}
<div class="mt-8 pr-0 md:pr-12">
    <h1 class="font-display text-4xl md:text-5xl tracking-[0.25em] text-foreground leading-[0.9] mb-6">
        LEFT VS RIGHT
    </h1>

    <div class="grid md:grid-cols-2 gap-6 mb-6">
        <!-- Left Hand -->
        <div class="bg-card border-4 border-foreground p-6" style="box-shadow: 6px 6px 0 hsl(0, 0%, 10%);">
            <div class="text-center mb-4">
                <div class="text-5xl mb-2">ü§ö</div>
                <h2 class="font-display text-2xl tracking-wider text-foreground">LEFT HAND</h2>
            </div>
            <div id="leftHandData" class="space-y-3">
                <div class="text-center text-muted-foreground">Loading...</div>
            </div>
        </div>

        <!-- Right Hand -->
        <div class="bg-card border-4 border-foreground p-6" style="box-shadow: 6px 6px 0 hsl(0, 0%, 10%);">
            <div class="text-center mb-4">
                <div class="text-5xl mb-2">üëã</div>
                <h2 class="font-display text-2xl tracking-wider text-foreground">RIGHT HAND</h2>
            </div>
            <div id="rightHandData" class="space-y-3">
                <div class="text-center text-muted-foreground">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Instructions -->
    <div class="bg-card border-4 border-foreground p-4" style="box-shadow: 6px 6px 0 hsl(0, 0%, 10%);">
        <div class="font-display text-sm tracking-widest text-foreground/70 mb-2">
            üìã HOW TO USE
        </div>
        <ul class="text-xs font-bold tracking-wider text-foreground/80 space-y-1">
            <li>‚Ä¢ Record sessions using ONLY your left hand in Freestyle</li>
            <li>‚Ä¢ Record sessions using ONLY your right hand separately</li>
            <li>‚Ä¢ Compare shakiness scores to track progress for each hand</li>
            <li>‚Ä¢ Lower tremor values = smoother movement</li>
        </ul>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function loadHandComparison() {
    try {
        const [leftRes, rightRes] = await Promise.all([
            fetch('/api/user/default_user/analytics/hand/Left'),
            fetch('/api/user/default_user/analytics/hand/Right')
        ]);

        if (leftRes.ok) {
            const left = await leftRes.json();
            renderHandData('leftHandData', left, 'purple');
        } else {
            document.getElementById('leftHandData').innerHTML = '<div class="text-center text-muted-foreground">No data for left hand</div>';
        }

        if (rightRes.ok) {
            const right = await rightRes.json();
            renderHandData('rightHandData', right, 'blue');
        } else {
            document.getElementById('rightHandData').innerHTML = '<div class="text-center text-muted-foreground">No data for right hand</div>';
        }
    } catch (error) {
        console.error('Error loading hand comparison:', error);
    }
}

function renderHandData(elementId, data, color) {
    const shakinessScore = Math.max(0, Math.min(100, 100 - (data.avg_tremor * 8000)));
    const scoreColor = shakinessScore >= 70 ? 'green' : shakinessScore >= 40 ? 'yellow' : 'red';
    const statusEmoji = shakinessScore >= 70 ? '‚úÖ' : shakinessScore >= 40 ? 'üëç' : '‚ö†Ô∏è';
    const statusText = shakinessScore >= 70 ? 'Very Smooth' : shakinessScore >= 40 ? 'Good' : 'Shaky';

    const html = `
        <div class="p-4 bg-${color}-100 rounded-lg border-2 border-foreground">
            <div class="text-xs font-bold tracking-wider text-foreground/60 mb-1">SHAKINESS SCORE</div>
            <div class="text-4xl font-display tracking-wider" style="color: ${scoreColor === 'green' ? '#22c55e' : scoreColor === 'yellow' ? '#eab308' : '#ef4444'}">
                ${shakinessScore.toFixed(0)}<span class="text-lg">/100</span>
            </div>
            <div class="text-xs font-bold tracking-wider text-foreground/60 mt-1">
                ${statusEmoji} ${statusText}
            </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
            <div class="p-3 bg-muted rounded-lg border-2 border-foreground">
                <div class="text-[10px] font-bold tracking-wider text-foreground/60">TREMOR</div>
                <div class="text-xl font-display tracking-wider text-foreground">
                    ${(data.avg_tremor * 1000).toFixed(3)}
                </div>
                <div class="text-[8px] font-bold tracking-wider text-foreground/40">√ó10‚Åª¬≥</div>
            </div>

            <div class="p-3 bg-muted rounded-lg border-2 border-foreground">
                <div class="text-[10px] font-bold tracking-wider text-foreground/60">SMOOTHNESS</div>
                <div class="text-xl font-display tracking-wider text-foreground">
                    ${data.avg_smoothness.toFixed(0)}
                </div>
                <div class="text-[8px] font-bold tracking-wider text-foreground/40">jerk</div>
            </div>
        </div>

        <div class="p-3 bg-muted rounded-lg border-2 border-foreground">
            <div class="text-[10px] font-bold tracking-wider text-foreground/60">SPEED</div>
            <div class="text-xl font-display tracking-wider text-foreground">
                ${data.avg_speed.toFixed(3)}
            </div>
        </div>
    `;

    document.getElementById(elementId).innerHTML = html;
}

// Load on page load
loadHandComparison();
</script>
{% endblock %}
